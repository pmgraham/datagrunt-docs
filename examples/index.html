<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Usage Examples - datagrunt</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Usage Examples";
        var mkdocs_page_input_path = "examples.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> datagrunt
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Usage Examples</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#setting-the-processing-engine">Setting The Processing Engine</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#working-with-csv-properties">Working with CSV Properties</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#get-csv-delimiter">Get CSV Delimiter</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#manually-set-csv-delimiter">Manually Set CSV Delimiter</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sampling-csv-data">Sampling CSV Data</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#reading-csv-files">Reading CSV Files</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#using-duckdb">Using DuckDB</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#using-polars">Using Polars</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#writing-csv-to-other-formats">Writing CSV to Other Formats</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#json-and-json-lines-with-duckdb">JSON and JSON Lines with DuckDB</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#json-and-json-lines-with-polars">JSON and JSON Lines with Polars</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#integration-with-pandas">Integration with Pandas</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using-sql-to-query-csv-files">Using SQL To Query CSV Files</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#write-a-sql-query">Write a SQL Query</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#query-a-polars-dataframe">Query a Polars Dataframe</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#query-results-to-dataframe">Query Results To Dataframe</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#credits-and-references">Credits and References</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../api/">API</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">datagrunt</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Usage Examples</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="usage-examples">Usage Examples</h2>
<p>Datagrunt offers a variety of functionalities. Here are some common use cases to help you get started.</p>
<h3 id="setting-the-processing-engine">Setting The Processing Engine</h3>
<p>Datagrunt gives you two options for CSV file processing: DuckDB and Polars. You set the engine as follows:</p>
<pre><code class="language-python">from datagrunt import CSVReader

csv_file = 'myfile.csv'
dg = CSVReader(csv_file) # by default engine is set to 'polars'.
</code></pre>
<p>Alternatively, you may set the processing engine to DuckDB by passing the 'duckdb' value for the engine param as follows:</p>
<pre><code class="language-python">from datagrunt import CSVReader

csv_file = 'myfile.csv'
engine = 'duckdb'
dg = CSVReader(csv_file, engine=engine)
</code></pre>
<p>The interface is the exact same for both engines. If you write your code using Polars, but want to change to DuckDB later, simply update the engine param when you instantiate the CSVReader class and leave the rest of your code untouched.</p>
<p>The engine functionality works exactly the same way for the CSVWriter class as well. Here is an example using the Polars engine:</p>
<pre><code class="language-python">from datagrunt import CSVWriter

csv_file = 'myfile.csv'
dg = CSVWriter(csv_file)

dg.write_json()
</code></pre>
<p>Here is an example using the DuckDB engine:</p>
<pre><code class="language-python">from datagrunt import CSVWriter

csv_file = 'myfile.csv'
engine = 'duckdb'
dg = CSVWriter(csv_file, engine=engine)

dg.write_json()
</code></pre>
<hr />
<h3 id="working-with-csv-properties">Working with CSV Properties</h3>
<h4 id="get-csv-delimiter">Get CSV Delimiter</h4>
<pre><code class="language-python">from datagrunt import CSVReader

csv_file = 'myfile.csv'
csv_props = CSVReader(csv_file)
delimiter = csv_props.delimiter
# Optional: Use delimiter.encode() to return a bytestring
</code></pre>
<h4 id="manually-set-csv-delimiter">Manually Set CSV Delimiter</h4>
<pre><code class="language-python">from datagrunt import CSVReader

csv_file = 'myfile.csv'
csv_props = CSVReader(csv_file)
csv_props.delimiter = ','  # Override the inferred delimiter
</code></pre>
<hr />
<h3 id="sampling-csv-data">Sampling CSV Data</h3>
<pre><code class="language-python">from datagrunt import CSVReader

csv_file = 'myfile.csv'

# Sample using DuckDB (prints to screen automatically)
CSVReader(csv_file, engine='duckdb').get_sample()

# Sample using Polars (prints to screen automatically)
CSVReader(csv_file).get_sample()
</code></pre>
<hr />
<h3 id="reading-csv-files">Reading CSV Files</h3>
<h4 id="using-duckdb">Using DuckDB</h4>
<pre><code class="language-python">from datagrunt import CSVReader

csv_file = 'myfile.csv'
engine = 'duckdb'
duckdb_reader = CSVReader(csv_file, engine=engine)
df_duckdb = duckdb_reader.to_dataframe()
</code></pre>
<h4 id="using-polars">Using Polars</h4>
<pre><code class="language-python">from datagrunt import CSVReader

csv_file = 'myfile.csv'
polars_reader = CSVReader(csv_file)
df_polars = polars_reader.to_dataframe()
</code></pre>
<hr />
<h3 id="writing-csv-to-other-formats">Writing CSV to Other Formats</h3>
<h4 id="json-and-json-lines-with-duckdb">JSON and JSON Lines with DuckDB</h4>
<pre><code class="language-python">from datagrunt import CSVWriter

csv_file = 'myfile.csv'
engine = 'duckdb'
duckdb_writer = CSVWriter(csv_file, engine=engine)

# Write to JSON
duckdb_writer.write_json()  # Optional: Specify output filename

# Write to JSON Lines
duckdb_writer.write_json_newline_delimited()
</code></pre>
<h4 id="json-and-json-lines-with-polars">JSON and JSON Lines with Polars</h4>
<pre><code class="language-python">from datagrunt import CSVWriter

csv_file = 'myfile.csv'
polars_writer = CSVWriter(csv_file)

# Write to JSON
polars_writer.write_json()  # Optional: Specify output filename

# Write to JSON Lines
polars_writer.write_json_newline_delimited()  # Use .jsonl extension if specifying filename
</code></pre>
<h4 id="integration-with-pandas">Integration with Pandas</h4>
<pre><code class="language-python">from datagrunt import CSVReader
import pandas as pd

csv_file = 'myfile.csv'
csv_props = CSVReader(csv_file)

df_polars = csv_props.to_dataframe() # returns Polars dataframe automatically

# convert Polars dataframe to Pandas
df_pandas_from_polars = df_polars.to_pandas()

# Use Datagrunt to get the correct delimiter for Pandas
df_pandas = pd.read_csv(csv_file, delimiter=csv_props.delimiter)
</code></pre>
<hr />
<h3 id="using-sql-to-query-csv-files">Using SQL To Query CSV Files</h3>
<p>It's recommened to use the <code>duckdb</code> engine when querying CSV files using SQL. These query examples will work with the <code>polars</code> engine exactly the same way as presented, but Datagrunt converts all data to strings when using <code>duckdb</code> and it better preserves the integrity of the data due to not coercing into inferred datatypes. You'll see below that you can use SQL and you can optionally cast columns to different data types as needed.</p>
<p>In the below example there are postal codes in the data. Usually, postal codes are read as integers by most processing engines. However, many postal codes begin with a leading 0, and in that case if postal codes are read as an integer, the leading 0 will be dropped erroneously. This can be fixed by using the <code>zfill</code> function in Python, but we'd prefer to present the data in its original form as a string as opposed to having the data altered due to data type conversion.</p>
<p>Zipcodes are only one of many examples where data integrity may be lost due to type conversions. Therefore, we do our best to preserve the data in its original state, even if it means we have to type case downstream.</p>
<pre><code class="language-python">from datagrunt import CSVReader

csv_file = 'electric_vehicle_population_data.csv'
engine = 'duckdb'

dg = CSVReader(csv_file, engine=engine) # set duckdb as the processing engine.

df = dg.to_dataframe() # only a sample output below is represented.
</code></pre>
<table>
<thead>
<tr>
<th>VIN (1-10)</th>
<th>County</th>
<th>City</th>
<th>State</th>
<th>DOL Vehicle ID</th>
<th>Vehicle Location</th>
<th>Electric Utility</th>
<th>2020 Census Tract</th>
</tr>
</thead>
<tbody>
<tr>
<td>5YJSA1E28K</td>
<td>Snohomish</td>
<td>Mukilteo</td>
<td>WA</td>
<td>236424583</td>
<td>POINT (-122.29943 47.912654)</td>
<td>PUGET SOUND ENERGY INC</td>
<td>53061042001</td>
</tr>
<tr>
<td>1C4JJXP68P</td>
<td>Yakima</td>
<td>Yakima</td>
<td>WA</td>
<td>249905295</td>
<td>POINT (-120.468875 46.6046178)</td>
<td>PACIFICORP</td>
<td>53077001601</td>
</tr>
<tr>
<td>WBY8P6C05L</td>
<td>Kitsap</td>
<td>Kingston</td>
<td>WA</td>
<td>260917289</td>
<td>POINT (-122.5178351 47.7981436)</td>
<td>PUGET SOUND ENERGY INC</td>
<td>53035090102</td>
</tr>
<tr>
<td>JTDKARFP1J</td>
<td>Kitsap</td>
<td>Port Orchard</td>
<td>WA</td>
<td>186410087</td>
<td>POINT (-122.6530052 47.4739066)</td>
<td>PUGET SOUND ENERGY INC</td>
<td>53035092802</td>
</tr>
<tr>
<td>5UXTA6C09N</td>
<td>Snohomish</td>
<td>Everett</td>
<td>WA</td>
<td>186076915</td>
<td>POINT (-122.2032349 47.8956271)</td>
<td>PUGET SOUND ENERGY INC</td>
<td>53061041605</td>
</tr>
<tr>
<td>JTMAB3FVXR</td>
<td>Snohomish</td>
<td>Snohomish</td>
<td>WA</td>
<td>262809249</td>
<td>POINT (-122.0483457 47.9435765)</td>
<td>PUGET SOUND ENERGY INC</td>
<td>53061052402</td>
</tr>
<tr>
<td>7FCTGAAA7P</td>
<td>Pierce</td>
<td>Orting</td>
<td>WA</td>
<td>252195450</td>
<td>POINT (-122.1977914 47.0948565)</td>
<td>PUGET SOUND ENERGY INC||CITY O...</td>
<td>53053070100</td>
</tr>
<tr>
<td>1V2GNPE87P</td>
<td>Spokane</td>
<td>Spokane</td>
<td>WA</td>
<td>227314790</td>
<td>POINT (-117.428902 47.658268)</td>
<td>MO</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="write-a-sql-query">Write a SQL Query</h4>
<pre><code class="language-python">from datagrunt import CSVReader

csv_file = 'electric_vehicle_population_data.csv'
engine = 'duckdb'

dg = CSVReader(csv_file, engine=engine) # set duckdb as the processing engine.

# the db_table object is an instance attribute provided by the CSVReader class. It's a temporary object created by DuckDB for local data processing.
query = f&quot;&quot;&quot;
WITH core AS (
    SELECT
        City AS city,
        &quot;VIN (1-10)&quot; AS vin
    FROM {dg.db_table}
)
SELECT
    city,
    COUNT(vin) AS vehicle_count
FROM core
GROUP BY 1
ORDER BY 2 DESC
&quot;&quot;&quot;

dg.query_data(query)
</code></pre>
<table>
<thead>
<tr>
<th>city</th>
<th>vehicle_count</th>
</tr>
</thead>
<tbody>
<tr>
<td>Seattle</td>
<td>32602</td>
</tr>
<tr>
<td>Bellevue</td>
<td>9960</td>
</tr>
<tr>
<td>Redmond</td>
<td>7165</td>
</tr>
<tr>
<td>Vancouver</td>
<td>7081</td>
</tr>
<tr>
<td>Bothell</td>
<td>6602</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
</tr>
<tr>
<td>Vista</td>
<td>1</td>
</tr>
<tr>
<td>Tempe</td>
<td>1</td>
</tr>
<tr>
<td>Green Bay</td>
<td>1</td>
</tr>
<tr>
<td>Waverly</td>
<td>1</td>
</tr>
<tr>
<td>Creston</td>
<td>1</td>
</tr>
<tr>
<td>764 rows (20 shown)   2 columns</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="query-a-polars-dataframe">Query a Polars Dataframe</h4>
<p><strong>Note:</strong> in the code example below that we are not interpolating the dataframe variable. We are referencing it by embedding it in the string.</p>
<pre><code class="language-python">from datagrunt import CSVReader

csv_file = 'electric_vehicle_population_data.csv'
engine = 'duckdb'

dg = CSVReader(csv_file, engine=engine) # set duckdb as the processing engine.
df = dg.to_dataframe()

# notice that the dataframe object df is not interpolated.
df_query = &quot;&quot;&quot;
WITH core AS (
    SELECT
        City AS city,
        &quot;VIN (1-10)&quot; AS vin
    FROM df
)
SELECT
    city,
    COUNT(vin) AS vehicle_count
FROM core
GROUP BY 1
ORDER BY 2 DESC
&quot;&quot;&quot;

dg.query_data(df_query)
</code></pre>
<table>
<thead>
<tr>
<th>city</th>
<th>vehicle_count</th>
</tr>
</thead>
<tbody>
<tr>
<td>Seattle</td>
<td>32602</td>
</tr>
<tr>
<td>Bellevue</td>
<td>9960</td>
</tr>
<tr>
<td>Redmond</td>
<td>7165</td>
</tr>
<tr>
<td>Vancouver</td>
<td>7081</td>
</tr>
<tr>
<td>Bothell</td>
<td>6602</td>
</tr>
<tr>
<td>Kirkland</td>
<td>5883</td>
</tr>
<tr>
<td>Renton</td>
<td>5835</td>
</tr>
<tr>
<td>Sammamish</td>
<td>5795</td>
</tr>
<tr>
<td>Olympia</td>
<td>4830</td>
</tr>
<tr>
<td>Tacoma</td>
<td>4204</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
</tr>
<tr>
<td>Lamont</td>
<td>1</td>
</tr>
<tr>
<td>Dickinson</td>
<td>1</td>
</tr>
<tr>
<td>Saratoga Springs</td>
<td>1</td>
</tr>
<tr>
<td>Gunpowder</td>
<td>1</td>
</tr>
<tr>
<td>Holden Village</td>
<td>1</td>
</tr>
<tr>
<td>Yorktown</td>
<td>1</td>
</tr>
<tr>
<td>Ridgecrest</td>
<td>1</td>
</tr>
<tr>
<td>Startup</td>
<td>1</td>
</tr>
<tr>
<td>Sacramento</td>
<td>1</td>
</tr>
<tr>
<td>Washtucna</td>
<td>1</td>
</tr>
<tr>
<td>764 rows (20 shown)   2 columns</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="query-results-to-dataframe">Query Results To Dataframe</h4>
<p>In the previous example we demonstrated querying a Polars dataframe by using SQL. Rather than simply returning results, you may convert the results to any type of dataframe you wish.</p>
<pre><code class="language-python">from datagrunt import CSVReader

csv_file = 'electric_vehicle_population_data.csv'
engine = 'duckdb'

dg = CSVReader(csv_file, engine=engine) # set duckdb as the processing engine.
df = dg.to_dataframe()

df_query = &quot;&quot;&quot;
WITH core AS (
    SELECT
        City AS city,
        &quot;VIN (1-10)&quot; AS vin
    FROM df
)
SELECT
    city,
    COUNT(vin) AS vehicle_count
FROM core
GROUP BY 1
ORDER BY 2 DESC
&quot;&quot;&quot;

df_polars = dg.query_data(df_query).pl() # return a Polars dataframe
df_pandas =  dg.query_data(df_query).to_df() # return a Pandas dataframe
</code></pre>
<h4 id="credits-and-references">Credits and References</h4>
<p>The SQL query functionality within Datagrunt is powered by <a href="https://duckdb.org/">DuckDB</a>.
The dataset used in these code examples is sourced from <a href="https://catalog.data.gov/dataset/electric-vehicle-population-data/resource/fa51be35-691f-45d2-9f3e-535877965e69">Electric Vehicle Population Data</a>.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href=".." class="btn btn-neutral float-left" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../api/" class="btn btn-neutral float-right" title="API">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href=".." style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../api/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
